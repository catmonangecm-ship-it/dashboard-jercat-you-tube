<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord YouTube - Automatique</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        /* Dark Mode */
        body.dark-mode { background: linear-gradient(to bottom right, #0f172a, #1e293b); color: #e2e8f0; }
        body.dark-mode .bg-white { background-color: #1e293b !important; }
        body.dark-mode .bg-gray-50 { background-color: #0f172a !important; }
        body.dark-mode .bg-gray-100 { background-color: #334155 !important; }
        body.dark-mode .text-gray-900 { color: #f1f5f9 !important; }
        body.dark-mode .text-gray-700 { color: #cbd5e1 !important; }
        body.dark-mode .text-gray-600 { color: #94a3b8 !important; }
        body.dark-mode .text-gray-500 { color: #64748b !important; }
        body.dark-mode .border-gray-200 { border-color: #334155 !important; }
        body.dark-mode .shadow { box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3) !important; }
        
        .stat-card { transition: all 0.3s ease; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); }
        .progress-bar { transition: width 0.5s ease; }
        .metric-badge { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        
        .chart-container { position: relative; height: 300px; }
        
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-connected { background-color: #10b981; animation: pulse 2s infinite; }
        .status-disconnected { background-color: #ef4444; }
        .status-loading { background-color: #f59e0b; animation: pulse 1s infinite; }

        .setup-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .setup-modal.active { display: flex; }
    </style>
</head>
<body class="bg-gray-50">
    
    <!-- Modal de configuration -->
    <div id="setupModal" class="setup-modal active">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">üîß Configuration API YouTube</h2>
            <p class="text-gray-600 mb-6">Pour activer la synchronisation automatique, vous devez configurer l'acc√®s √† l'API YouTube.</p>
            
            <div class="space-y-4 mb-6">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Cl√© API YouTube Data v3</label>
                    <input type="text" id="apiKeyInput" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="AIzaSy...">
                    <p class="text-xs text-gray-500 mt-1">
                        <a href="https://console.cloud.google.com/apis/credentials" target="_blank" class="text-blue-600 hover:underline">
                            Obtenir une cl√© API Google
                        </a>
                    </p>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">ID de votre cha√Æne YouTube</label>
                    <input type="text" id="channelIdInput" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="UC...">
                    <p class="text-xs text-gray-500 mt-1">
                        Trouvez votre ID : YouTube Studio ‚Üí Param√®tres ‚Üí Cha√Æne ‚Üí Informations avanc√©es
                    </p>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Fr√©quence de synchronisation</label>
                    <select id="syncFrequency" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="300000">Toutes les 5 minutes</option>
                        <option value="600000">Toutes les 10 minutes</option>
                        <option value="1800000">Toutes les 30 minutes</option>
                        <option value="3600000">Toutes les heures</option>
                    </select>
                </div>
            </div>

            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <h3 class="text-sm font-bold text-blue-900 mb-2">üìö Guide rapide :</h3>
                <ol class="text-xs text-blue-800 space-y-1 ml-4 list-decimal">
                    <li>Allez sur <a href="https://console.cloud.google.com/" target="_blank" class="underline">Google Cloud Console</a></li>
                    <li>Cr√©ez un nouveau projet (ou s√©lectionnez-en un)</li>
                    <li>Activez "YouTube Data API v3"</li>
                    <li>Cr√©ez des identifiants ‚Üí Cl√© API</li>
                    <li>Copiez la cl√© et collez-la ci-dessus</li>
                    <li>Trouvez votre ID de cha√Æne dans YouTube Studio</li>
                </ol>
            </div>

            <div class="flex gap-3">
                <button onclick="saveConfig()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                    üíæ Sauvegarder et connecter
                </button>
                <button onclick="useManualMode()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-3 px-6 rounded-lg transition-colors">
                    Mode manuel
                </button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-red-600 rounded-xl flex items-center justify-center">
                    <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                    </svg>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-gray-900">Tableau de Bord YouTube</h1>
                    <div class="flex items-center text-xs">
                        <span id="connectionStatus" class="status-dot status-disconnected"></span>
                        <span id="connectionText" class="text-gray-500">Non connect√©</span>
                    </div>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="manualSync()" id="syncBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold text-sm transition-colors flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    Sync
                </button>
                <button onclick="openSettings()" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold text-sm transition-colors">
                    ‚öôÔ∏è
                </button>
                <button onclick="toggleDarkMode()" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold text-sm transition-colors">
                    üåô
                </button>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 py-8">
        
        <!-- Date et mise √† jour -->
        <div class="flex items-center justify-between mb-8">
            <div>
                <h2 class="text-2xl font-bold text-gray-900">Vue d'ensemble</h2>
                <p class="text-sm text-gray-500">
                    Derni√®re sync : <span id="lastSync">Jamais</span>
                    <span class="ml-2 text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">
                        Auto-sync : <span id="autoSyncStatus">OFF</span>
                    </span>
                </p>
            </div>
            <div id="loadingIndicator" class="loading-spinner" style="display: none;"></div>
        </div>

        <!-- KPIs Principaux -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            
            <!-- Abonn√©s -->
            <div class="stat-card bg-white rounded-xl p-6 shadow">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                        </svg>
                    </div>
                    <span class="text-xs font-semibold text-green-600 bg-green-100 px-2 py-1 rounded">
                        +<span id="subsGrowth">0</span>
                    </span>
                </div>
                <div class="text-3xl font-bold text-gray-900 mb-1" id="subscribers">0</div>
                <div class="text-sm text-gray-600">Abonn√©s</div>
                <div class="mt-4 text-xs text-gray-500">
                    Objectif: <span id="subsObjective">1000</span> | Reste: <span id="subsRemaining">1000</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                    <div id="subsProgress" class="progress-bar bg-red-600 h-2 rounded-full" style="width: 0%"></div>
                </div>
            </div>

            <!-- Vues totales -->
            <div class="stat-card bg-white rounded-xl p-6 shadow">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <span class="text-xs font-semibold text-green-600 bg-green-100 px-2 py-1 rounded">
                        +<span id="viewsGrowth">0</span>
                    </span>
                </div>
                <div class="text-3xl font-bold text-gray-900 mb-1" id="views">0</div>
                <div class="text-sm text-gray-600">Vues totales</div>
                <div class="mt-4 text-xs text-gray-500">
                    Objectif: <span id="viewsObjective">10000</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                    <div id="viewsProgress" class="progress-bar bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
                </div>
            </div>

            <!-- Vid√©os publi√©es -->
            <div class="stat-card bg-white rounded-xl p-6 shadow">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"/>
                        </svg>
                    </div>
                    <span class="text-xs font-semibold text-blue-600 bg-blue-100 px-2 py-1 rounded">
                        +<span id="videosNew">0</span> cette semaine
                    </span>
                </div>
                <div class="text-3xl font-bold text-gray-900 mb-1" id="videos">0</div>
                <div class="text-sm text-gray-600">Vid√©os publi√©es</div>
                <div class="mt-4 text-xs text-gray-500">
                    Derni√®re upload: <span id="lastUpload">N/A</span>
                </div>
            </div>

            <!-- Commentaires -->
            <div class="stat-card bg-white rounded-xl p-6 shadow">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <span class="text-xs font-semibold text-purple-600 bg-purple-100 px-2 py-1 rounded">
                        Engagement: <span id="engagementRate">0</span>%
                    </span>
                </div>
                <div class="text-3xl font-bold text-gray-900 mb-1" id="comments">0</div>
                <div class="text-sm text-gray-600">Commentaires</div>
                <div class="mt-4 text-xs text-gray-500">
                    Likes: <span id="likes">0</span>
                </div>
            </div>
        </div>

        <!-- Derni√®res vid√©os -->
        <div class="bg-white rounded-xl p-6 shadow mb-8">
            <h3 class="text-lg font-bold text-gray-900 mb-4">üé¨ Derni√®res vid√©os</h3>
            <div id="recentVideos" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="text-center text-gray-500 py-8">Aucune vid√©o charg√©e</div>
            </div>
        </div>

        <!-- Graphiques -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            
            <!-- √âvolution des vues -->
            <div class="bg-white rounded-xl p-6 shadow">
                <h3 class="text-lg font-bold text-gray-900 mb-4">√âvolution des vues (7 derniers jours)</h3>
                <div class="chart-container">
                    <canvas id="viewsChart"></canvas>
                </div>
            </div>

            <!-- Top Vid√©os -->
            <div class="bg-white rounded-xl p-6 shadow">
                <h3 class="text-lg font-bold text-gray-900 mb-4">Top 5 Vid√©os (vues)</h3>
                <div class="chart-container">
                    <canvas id="topVideosChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Statistiques d√©taill√©es -->
        <div class="bg-white rounded-xl p-6 shadow">
            <h3 class="text-lg font-bold text-gray-900 mb-4">üìä Statistiques d√©taill√©es</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600" id="avgViews">0</div>
                    <div class="text-xs text-gray-600 mt-1">Vues moyennes/vid√©o</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-purple-600" id="avgLikes">0</div>
                    <div class="text-xs text-gray-600 mt-1">Likes moyens/vid√©o</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-600" id="avgComments">0</div>
                    <div class="text-xs text-gray-600 mt-1">Commentaires moyens</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-red-600" id="totalDuration">0h</div>
                    <div class="text-xs text-gray-600 mt-1">Dur√©e totale contenu</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        let config = {
            apiKey: '',
            channelId: '',
            syncFrequency: 300000,
            manualMode: false
        };

        let syncInterval = null;
        let charts = {};
        let channelData = {};

        // Charger la configuration
        function loadConfig() {
            const saved = localStorage.getItem('youtubeConfig');
            if (saved) {
                config = JSON.parse(saved);
                if (config.apiKey && config.channelId && !config.manualMode) {
                    document.getElementById('setupModal').classList.remove('active');
                    startAutoSync();
                    return true;
                }
            }
            return false;
        }

        // Sauvegarder la configuration
        function saveConfig() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            const channelId = document.getElementById('channelIdInput').value.trim();
            const syncFreq = parseInt(document.getElementById('syncFrequency').value);

            if (!apiKey || !channelId) {
                alert('‚ùå Veuillez remplir tous les champs');
                return;
            }

            config = { apiKey, channelId, syncFrequency: syncFreq, manualMode: false };
            localStorage.setItem('youtubeConfig', JSON.stringify(config));
            
            document.getElementById('setupModal').classList.remove('active');
            startAutoSync();
            manualSync();
        }

        // Mode manuel
        function useManualMode() {
            config.manualMode = true;
            localStorage.setItem('youtubeConfig', JSON.stringify(config));
            document.getElementById('setupModal').classList.remove('active');
            updateConnectionStatus('disconnected');
        }

        // Ouvrir les param√®tres
        function openSettings() {
            document.getElementById('apiKeyInput').value = config.apiKey || '';
            document.getElementById('channelIdInput').value = config.channelId || '';
            document.getElementById('syncFrequency').value = config.syncFrequency || 300000;
            document.getElementById('setupModal').classList.add('active');
        }

        // Mise √† jour du statut de connexion
        function updateConnectionStatus(status) {
            const dot = document.getElementById('connectionStatus');
            const text = document.getElementById('connectionText');
            
            dot.className = 'status-dot';
            
            if (status === 'connected') {
                dot.classList.add('status-connected');
                text.textContent = 'Connect√© ‚Ä¢ Auto-sync actif';
                document.getElementById('autoSyncStatus').textContent = 'ON';
            } else if (status === 'loading') {
                dot.classList.add('status-loading');
                text.textContent = 'Synchronisation...';
            } else {
                dot.classList.add('status-disconnected');
                text.textContent = 'Non connect√©';
                document.getElementById('autoSyncStatus').textContent = 'OFF';
            }
        }

        // Synchronisation manuelle
        async function manualSync() {
            if (config.manualMode || !config.apiKey || !config.channelId) {
                alert('‚ö†Ô∏è Veuillez configurer l\'API YouTube d\'abord');
                openSettings();
                return;
            }

            updateConnectionStatus('loading');
            document.getElementById('loadingIndicator').style.display = 'block';

            try {
                await fetchYouTubeData();
                updateConnectionStatus('connected');
                document.getElementById('lastSync').textContent = new Date().toLocaleString('fr-FR');
            } catch (error) {
                console.error('Erreur de synchronisation:', error);
                alert('‚ùå Erreur de synchronisation: ' + error.message);
                updateConnectionStatus('disconnected');
            } finally {
                document.getElementById('loadingIndicator').style.display = 'none';
            }
        }

        // R√©cup√©rer les donn√©es YouTube
        async function fetchYouTubeData() {
            const { apiKey, channelId } = config;
            
            // R√©cup√©rer les statistiques de la cha√Æne
            const channelResponse = await fetch(
                `https://www.googleapis.com/youtube/v3/channels?part=statistics,snippet,contentDetails&id=${channelId}&key=${apiKey}`
            );
            
            if (!channelResponse.ok) {
                throw new Error('Erreur API: ' + channelResponse.status);
            }
            
            const channelData = await channelResponse.json();
            
            if (!channelData.items || channelData.items.length === 0) {
                throw new Error('Cha√Æne non trouv√©e. V√©rifiez l\'ID de la cha√Æne.');
            }
            
            const stats = channelData.items[0].statistics;
            const snippet = channelData.items[0].snippet;
            
            // Mettre √† jour les KPIs
            updateKPIs(stats);
            
            // R√©cup√©rer les derni√®res vid√©os
            const uploadsPlaylistId = channelData.items[0].contentDetails.relatedPlaylists.uploads;
            await fetchRecentVideos(uploadsPlaylistId);
        }

        // Mettre √† jour les KPIs
        function updateKPIs(stats) {
            const subscribers = parseInt(stats.subscriberCount) || 0;
            const views = parseInt(stats.viewCount) || 0;
            const videos = parseInt(stats.videoCount) || 0;
            const comments = parseInt(stats.commentCount) || 0;

            // Calculer la croissance (comparaison avec donn√©es pr√©c√©dentes)
            const prevData = JSON.parse(localStorage.getItem('prevStats') || '{}');
            const subsGrowth = prevData.subscribers ? subscribers - prevData.subscribers : 0;
            const viewsGrowth = prevData.views ? views - prevData.views : 0;

            // Sauvegarder pour la prochaine fois
            localStorage.setItem('prevStats', JSON.stringify({ subscribers, views, videos, comments }));

            // Afficher
            document.getElementById('subscribers').textContent = subscribers.toLocaleString('fr-FR');
            document.getElementById('views').textContent = views.toLocaleString('fr-FR');
            document.getElementById('videos').textContent = videos;
            document.getElementById('comments').textContent = comments.toLocaleString('fr-FR');
            
            document.getElementById('subsGrowth').textContent = subsGrowth;
            document.getElementById('viewsGrowth').textContent = viewsGrowth;

            // Calculer les progressions
            const subsObj = 1000;
            const viewsObj = 10000;
            
            const subsProgress = Math.min((subscribers / subsObj) * 100, 100);
            const viewsProgress = Math.min((views / viewsObj) * 100, 100);
            
            document.getElementById('subsProgress').style.width = subsProgress + '%';
            document.getElementById('viewsProgress').style.width = viewsProgress + '%';
            document.getElementById('subsRemaining').textContent = Math.max(0, subsObj - subscribers);
        }

        // R√©cup√©rer les vid√©os r√©centes
        async function fetchRecentVideos(playlistId) {
            const { apiKey } = config;
            
            const response = await fetch(
                `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${playlistId}&maxResults=10&key=${apiKey}`
            );
            
            const data = await response.json();
            
            if (!data.items) return;

            // R√©cup√©rer les statistiques des vid√©os
            const videoIds = data.items.map(item => item.snippet.resourceId.videoId).join(',');
            const statsResponse = await fetch(
                `https://www.googleapis.com/youtube/v3/videos?part=statistics,contentDetails&id=${videoIds}&key=${apiKey}`
            );
            
            const statsData = await statsResponse.json();
            
            displayRecentVideos(data.items, statsData.items);
            updateCharts(data.items, statsData.items);
        }

        // Afficher les vid√©os r√©centes
        function displayRecentVideos(videos, stats) {
            const container = document.getElementById('recentVideos');
            container.innerHTML = '';

            videos.slice(0, 6).forEach((video, index) => {
                const videoStats = stats[index].statistics;
                const videoId = video.snippet.resourceId.videoId;
                
                const div = document.createElement('div');
                div.className = 'bg-gray-50 rounded-lg p-4 hover:shadow-md transition-shadow';
                div.innerHTML = `
                    <img src="${video.snippet.thumbnails.medium.url}" class="w-full rounded-lg mb-3" alt="${video.snippet.title}">
                    <h4 class="text-sm font-semibold text-gray-900 mb-2 line-clamp-2">${video.snippet.title}</h4>
                    <div class="flex items-center justify-between text-xs text-gray-600">
                        <span>üëÅÔ∏è ${parseInt(videoStats.viewCount).toLocaleString('fr-FR')}</span>
                        <span>üëç ${parseInt(videoStats.likeCount || 0).toLocaleString('fr-FR')}</span>
                        <span>üí¨ ${parseInt(videoStats.commentCount || 0).toLocaleString('fr-FR')}</span>
                    </div>
                    <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank" class="block mt-3 text-xs text-blue-600 hover:underline">
                        Voir sur YouTube ‚Üí
                    </a>
                `;
                container.appendChild(div);
            });

            // Calculer les moyennes
            const totalViews = stats.reduce((sum, s) => sum + parseInt(s.statistics.viewCount || 0), 0);
            const totalLikes = stats.reduce((sum, s) => sum + parseInt(s.statistics.likeCount || 0), 0);
            const totalComments = stats.reduce((sum, s) => sum + parseInt(s.statistics.commentCount || 0), 0);
            
            document.getElementById('avgViews').textContent = Math.round(totalViews / stats.length).toLocaleString('fr-FR');
            document.getElementById('avgLikes').textContent = Math.round(totalLikes / stats.length);
            document.getElementById('avgComments').textContent = Math.round(totalComments / stats.length);
            document.getElementById('likes').textContent = totalLikes.toLocaleString('fr-FR');
        }

        // Mettre √† jour les graphiques
        function updateCharts(videos, stats) {
            // Top 5 vid√©os
            const top5 = stats.slice(0, 5).map((s, i) => ({
                title: videos[i].snippet.title.substring(0, 30) + '...',
                views: parseInt(s.statistics.viewCount)
            }));

            if (charts.topVideos) {
                charts.topVideos.destroy();
            }

            const ctxTop = document.getElementById('topVideosChart').getContext('2d');
            charts.topVideos = new Chart(ctxTop, {
                type: 'bar',
                data: {
                    labels: top5.map(v => v.title),
                    datasets: [{
                        label: 'Vues',
                        data: top5.map(v => v.views),
                        backgroundColor: ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });

            // Graphique des vues (simul√© - n√©cessiterait YouTube Analytics API pour les vraies donn√©es)
            if (charts.views) {
                charts.views.destroy();
            }

            const ctxViews = document.getElementById('viewsChart').getContext('2d');
            charts.views = new Chart(ctxViews, {
                type: 'line',
                data: {
                    labels: Array.from({length: 7}, (_, i) => `J-${6-i}`),
                    datasets: [{
                        label: 'Vues',
                        data: Array.from({length: 7}, () => Math.floor(Math.random() * 500) + 100),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }

        // D√©marrer la synchronisation automatique
        function startAutoSync() {
            if (syncInterval) {
                clearInterval(syncInterval);
            }
            
            syncInterval = setInterval(manualSync, config.syncFrequency);
            updateConnectionStatus('connected');
        }

        // Dark mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        // Initialisation
        window.onload = function() {
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
            }
            
            if (!loadConfig()) {
                // Afficher le modal de configuration
                document.getElementById('setupModal').classList.add('active');
            }
        };
    </script>
</body>
</html>
